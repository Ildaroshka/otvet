<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –±–ª–æ–∫-—Å—Ö–µ–º–∞</title>
<link rel="stylesheet" href="style.css">
<style>

</style>
</head>
<body>
<div class="screen" id="app"></div>

<script>
const app = document.getElementById("app");
let step = 0;
let answers = [];
let resultType = ""; // –≥–ª–æ–±–∞–ª—å–Ω–∞—è

const questions = [
    { text: "–ö –≤–∞–º –ø–∏—à—É—Ç –∫–ª–∏–µ–Ω—Ç—ã?", answers: ["–î–∞", "–ù–µ—Ç"] },
    { text: "–ö–ª–∏–µ–Ω—Ç—ã –∑–∞–¥–∞—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –≤–æ–ø—Ä–æ—Å—ã?", answers: ["–î–∞", "–ò–Ω–æ–≥–¥–∞", "–ü–æ—á—Ç–∏ –Ω–µ—Ç"] },
    { text: "–í—ã –æ—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ –Ω–∏—Ö –≤—Ä—É—á–Ω—É—é?", answers: ["–î–∞", "–ù–µ—Ç"] },
    { text: "–ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç—å –±—ã—Å—Ç—Ä–æ ‚Äî –∫–ª–∏–µ–Ω—Ç —É—Ö–æ–¥–∏—Ç?", answers: ["–î–∞", "–ò–Ω–æ–≥–¥–∞", "–ù–µ—Ç"] },
    { text: "–ï—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã / –≤–æ–∑–≤—Ä–∞—Ç—ã?", answers: ["–î–∞", "–ù–µ—Ç"] }
];

function start() {
    step = 0;
    answers = [];
    renderQuestion();
}

function renderQuestion() {
    const q = questions[step];
    app.innerHTML = `
        <h1>${q.text}</h1>
        ${q.answers.map(a => `
            <div class="panel ${a.startsWith("–î–∞") ? "yes" : a === "–ò–Ω–æ–≥–¥–∞" ? "maybe" : "no"}"
                 onclick="answer('${a}')">${a}</div>
        `).join("")}
    `;
}

function answer(val) {
    answers.push(val);

    // –†–ê–ù–ù–ò–ô –í–´–•–û–î: –µ—Å–ª–∏ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –æ—Ç–≤–µ—Ç "–ù–µ—Ç"
    if (step === 0 && val === "–ù–µ—Ç") {
        // —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–±–æ—Ç –Ω–µ –Ω—É–∂–µ–Ω"
        renderDiagramEarlyExit();
        return;
    }

    step++;
    step < questions.length ? renderQuestion() : renderDiagram();
}


function renderDiagramEarlyExit() {
    const explanation = "–ü–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ—Ç ‚Äî —á–∞—Ç-–±–æ—Ç –Ω–µ –Ω—É–∂–µ–Ω, –±–∏–∑–Ω–µ—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.";

    app.innerHTML = `
      <div class="diagram">

        <div class="block client">
          <div class="title">üë§ –ö–ª–∏–µ–Ω—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>
          <div class="subtitle">–ü–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
        </div>

        <div class="arrow"></div>

        <div class="block human">
          <div class="title">üë§ –ß–∞—Ç-–±–æ—Ç –Ω–µ –Ω—É–∂–µ–Ω</div>
          <div class="subtitle">${explanation}</div>
        </div>

        <div class="arrow"></div>

        <div class="block money">
          <div class="title">üí∞ –†–µ–∑—É–ª—å—Ç–∞—Ç</div>
          <div class="subtitle">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–æ–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</div>
        </div>

      </div>

      <button class="save-btn" onclick="save()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–µ–π—Å</button>
      <button class="restart-btn" onclick="start()">üîÅ –ù–æ–≤—ã–π –ò–ü</button>
    `;

    const blocks = document.querySelectorAll('.block');
    blocks.forEach((b, i) =>
        setTimeout(() => b.classList.add('show'), i * 400)
    );
}


function renderDiagram() {

    let resultType = "none";
    let explanation = "";

    if (
        answers[0] === "–î–∞" &&
        answers[1] !== "–ü–æ—á—Ç–∏ –Ω–µ—Ç" &&
        answers[2] === "–î–∞" &&
        answers[3] !== "–ù–µ—Ç"
    ) {
        resultType = "bot";
        explanation = "–ó–¥–µ—Å—å –∫–ª–∏–µ–Ω—Ç—ã –∂–¥—É—Ç –æ—Ç–≤–µ—Ç–∞, –±–∏–∑–Ω–µ—Å —Ç–µ—Ä—è–µ—Ç –¥–µ–Ω—å–≥–∏ ‚Äî —á–∞—Ç-–±–æ—Ç –Ω—É–∂–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.";
    } 
    else if (
        answers[0] === "–î–∞" &&
        answers[1] === "–ò–Ω–æ–≥–¥–∞"
    ) {
        resultType = "partial";
        explanation = "–ß–∞—Å—Ç—å –≤–æ–ø—Ä–æ—Å–æ–≤ –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É.";
    } 
    else {
        resultType = "human";
        explanation = "–°–µ–π—á–∞—Å —á–∞—Ç-–±–æ—Ç –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω ‚Äî –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–µ–º—É –ø–æ–∑–∂–µ.";
    }

    app.innerHTML = `
      <div class="diagram">

        <div class="block client">
          <div class="title">üë§ –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç</div>
          <div class="subtitle">–ö–ª–∏–µ–Ω—Ç—ã —É–∂–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –≤ –±–∏–∑–Ω–µ—Å</div>
        </div>

        <div class="arrow"></div>

        <div class="block problem">
          <div class="title">‚ö†Ô∏è –•–∞–æ—Å –∏ –ø–æ—Ç–µ—Ä–∏</div>
          <div class="subtitle">–î–æ–ª–≥–æ –æ—Ç–≤–µ—á–∞—é—Ç ‚Äî –∫–ª–∏–µ–Ω—Ç—ã —É—Ö–æ–¥—è—Ç</div>
        </div>

        <div class="arrow"></div>

        <div class="block ${
            resultType === "bot" ? "bot" :
            resultType === "partial" ? "maybe-bot" :
            "human"
        }">
          <div class="title">
            ${
              resultType === "bot" ? "ü§ñ –ß–∞—Ç-–±–æ—Ç" :
              resultType === "partial" ? "ü§ñ –ß–∞—Ç-–±–æ—Ç —á–∞—Å—Ç–∏—á–Ω–æ" :
              "üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä"
            }
          </div>
          <div class="subtitle">
            ${explanation}
          </div>
        </div>

        <div class="arrow"></div>

        <div class="block money">
          <div class="title">üí∞ –†–µ–∑—É–ª—å—Ç–∞—Ç</div>
          <div class="subtitle">
            ${
              resultType === "bot" ? "–ë–æ–ª—å—à–µ –∑–∞—è–≤–æ–∫, –º–µ–Ω—å—à–µ —Ö–∞–æ—Å–∞" :
              resultType === "partial" ? "–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤" :
              "–ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä—É—á–Ω—É—é –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏"
            }
          </div>
        </div>

      </div>

      <button class="save-btn" onclick="saveAsTxt()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–µ–π—Å</button>
      <button class="restart-btn" onclick="start()">üîÅ –ù–æ–≤—ã–π –ò–ü</button>
    `;

    // –∞–Ω–∏–º–∞—Ü–∏—è –±–ª–æ–∫–æ–≤
    const blocks = document.querySelectorAll('.block');
    blocks.forEach((b, i) =>
        setTimeout(() => b.classList.add('show'), i * 400)
    );
}

function saveAsTxt() {
    // –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç
    let text = `–ö–µ–π—Å –æ—Ç ${new Date().toLocaleString()}\n\n`;
    text += "–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã:\n";

    questions.forEach((q, i) => {
        const ans = answers[i] || "‚Äî";
        text += `${i+1}. ${q.text} ‚Äî ${ans}\n`;
    });

    text += `\n–†–µ—à–µ–Ω–∏–µ:\n`;

    // resultType –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –±–µ—Ä–µ–º –∏–∑ renderDiagram
    let resultText = "";
    if (resultType === "bot") resultText = "ü§ñ –ß–∞—Ç-–±–æ—Ç\n–ë–æ–ª—å—à–µ –∑–∞—è–≤–æ–∫, –º–µ–Ω—å—à–µ —Ö–∞–æ—Å–∞";
    else if (resultType === "partial") resultText = "ü§ñ –ß–∞—Ç-–±–æ—Ç —á–∞—Å—Ç–∏—á–Ω–æ\n–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤";
    else resultText = "üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä\n–ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä—É—á–Ω—É—é –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏";

    text += resultText;

    // —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∏ —Å–∫–∞—á–∏–≤–∞–µ–º
    const blob = new Blob([text], {type: "text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `case_${Date.now()}.txt`;
    a.click();
    URL.revokeObjectURL(url);
}


function save() {
    localStorage.setItem("case_" + Date.now(), JSON.stringify(answers));
    alert("–ö–µ–π—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
}

// —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
app.innerHTML = `
    <h1>–†–∞–∑–±–µ—Ä—ë–º –±–∏–∑–Ω–µ—Å –∑–∞ 5 –º–∏–Ω—É—Ç</h1>
    <div class="panel yes" onclick="start()">–ù–ê–ß–ê–¢–¨</div>
`;
</script>
</body>
</html>
